<html>
<glypj>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Farcaster Punks</title>
  <style>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quick Multi-Collection Mint (SeaDrop)</title>
  <style>
    :root{--bg:#04060a;--card:#071019;--muted:#9aa4b2;--accent:#06b6d4}
    body{margin:0;background:var(--bg);color:#fff;font-family:Inter,Arial,Helvetica,sans-serif;display:flex;align-items:flex-start;justify-content:center;min-height:100vh;padding:28px}
    .wrap{width:100%;max-width:980px}
    header{display:flex;align-items:center;gap:18px;margin-bottom:14px}
    h1{margin:0;font-size:20px}
    .card{padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 8px 40px rgba(0,0,0,0.6)}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:10px}
    input[type=text], input[type=number] { padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04); background:transparent; color:#fff }
    label{font-size:13px;color:var(--muted)}
    button{padding:10px 14px;border-radius:8px;border:0;background:var(--accent);color:#002020;font-weight:700;cursor:pointer}
    .muted{color:var(--muted);font-size:13px}
    .meta{margin-top:10px;color:var(--muted);font-size:13px}
    a.small{color:#7dd3fc;text-decoration:none}
    .spacer{height:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Quick Multi-Collection Mint — SeaDrop (Base)</h1>
        <div class="muted">Masukkan contract address & info lalu klik Apply — tidak perlu edit file.</div>
      </div>
    </header>

    <div class="card">
      <!-- CONFIG UI -->
      <div>
        <label class="muted">Collection name</label><br/>
        <input id="cfg_name" type="text" placeholder="Based Glyphs Punks" style="width:320px" value="Based Glyphs Punks"/>
      </div>

      <div class="spacer"></div>

      <div class="row">
        <div>
          <label class="muted">NFT Contract (address)</label><br/>
          <input id="cfg_contract" type="text" placeholder="0x..." style="width:320px" value="0xA7A8E04195ab59c68e9d4fca396b6a4c42a446d7" />
        </div>

        <div>
          <label class="muted">OpenSea URL</label><br/>
          <input id="cfg_opensea" type="text" placeholder="https://opensea.io/collection/..." style="width:320px" value="https://opensea.io/collection/based-glyphs-punks"/>
        </div>

        <div>
          <label class="muted">Fallback price (ETH)</label><br/>
          <input id="cfg_price" type="text" placeholder="0.00005" style="width:140px" value="0.00005"/>
        </div>
      </div>

      <div class="spacer"></div>

      <div style="display:flex;gap:10px;align-items:center;">
        <button id="apply">Apply Config</button>
        <button id="connect">Connect Wallet</button>
      </div>

      <div class="spacer"></div>

      <!-- DYNAMIC UI -->
      <div id="mainArea" style="margin-top:8px; display:block">
        <h2 id="title">Based Glyphs Punks</h2>
        <div class="muted" id="desc">Mint directly on Base — price read from chain</div>

        <div style="margin-top:12px">
          <label class="muted">Qty</label>
          <input id="qty" type="number" min="1" value="1" style="width:80px"/>
          <button id="refresh">Refresh Price</button>
          <button id="mint" style="margin-left:6px">Mint Now</button>
        </div>

        <p id="priceLine" class="muted" style="margin-top:10px">Price (per token): <span id="price">-</span></p>
        <p id="feeLine" class="muted">Fee recipient: <span id="fee">-</span></p>
        <p id="status" style="margin-top:8px;color:#cfcfcf">Status: idle</p>

        <div class="meta">OpenSea: <a id="openseaLink" class="small" href="#" target="_blank">link</a></div>
      </div>
    </div>

    <p style="margin-top:12px" class="muted">SeaDrop address (fixed): <a class="small" href="https://basescan.org/address/0x00005EA00Ac477B1030CE78506496e8C2dE24bf5" target="_blank">0x00005EA0…24bf5</a></p>
  </div>

<script type="module">
import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.esm.min.js";

/* Quick Multi-Collection Mint (SeaDrop) - JS */
let CONFIG = {
  SEADROP_ADDRESS: "0x00005EA00Ac477B1030CE78506496e8C2dE24bf5",
  NFT_CONTRACT: "0xA7A8E04195ab59c68e9d4fca396b6a4c42a446d7",
  NAME: "Based Glyphs Punks",
  OPENSEA: "https://opensea.io/collection/based-glyphs-punks",
  FALLBACK_PRICE_ETH: "0.00005",
  FALLBACK_FEE_RECIPIENT: "0xd8556fDC3EBfa3EC6740C92C3420606Bc6c882f0"
};

const SEADROP_ABI = [
  "function getPublicDrop(address nftContract) external view returns (uint80 mintPrice, uint48 startTime, uint48 endTime, uint16 maxTotalMintableByWallet, uint16 feeBps, bool restrictFeeRecipients)",
  "function mintPublic(address nftContract, address feeRecipient, address minterIfNotPayer, uint256 quantity) external payable",
  "function getAllowedFeeRecipients(address nftContract) external view returns (address[] memory)",
  "function getFeeRecipients(address nftContract) external view returns (address[] memory)"
];

const applyBtn = document.getElementById("apply");
const connectBtn = document.getElementById("connect");
const refreshBtn = document.getElementById("refresh");
const mintBtn = document.getElementById("mint");
const qtyEl = document.getElementById("qty");
const priceEl = document.getElementById("price");
const feeEl = document.getElementById("fee");
const statusEl = document.getElementById("status");
const titleEl = document.getElementById("title");
const descEl = document.getElementById("desc");
const openseaLink = document.getElementById("openseaLink");

let provider, signer;

function setStatus(t){ statusEl.innerText = "Status: " + t; console.log(t); }
function short(a){ return a ? a.slice(0,6) + "..." + a.slice(-4) : "—"; }

function applyConfigFromForm(){
  const name = document.getElementById("cfg_name").value.trim();
  const contract = document.getElementById("cfg_contract").value.trim();
  const opensea = document.getElementById("cfg_opensea").value.trim();
  const price = document.getElementById("cfg_price").value.trim();

  if(!/^0x[a-fA-F0-9]{40}$/.test(contract)){
    alert("Contract address invalid. Pastikan format 0x...");
    return;
  }
  CONFIG.NFT_CONTRACT = contract;
  CONFIG.NAME = name || CONFIG.NAME;
  CONFIG.OPENSEA = opensea || CONFIG.OPENSEA;
  CONFIG.FALLBACK_PRICE_ETH = price || CONFIG.FALLBACK_PRICE_ETH;

  titleEl.innerText = CONFIG.NAME;
  descEl.innerText = CONFIG.NAME + " — mint directly on Base.";
  openseaLink.href = CONFIG.OPENSEA;
  openseaLink.innerText = CONFIG.OPENSEA;
  setStatus("Config applied for " + CONFIG.NFT_CONTRACT);

  readPriceOnChain().catch(e=>console.warn(e));
}

applyBtn.onclick = applyConfigFromForm;

async function ensureBaseNetwork() {
  if (!window.ethereum) throw new Error("No wallet provider");
  const chainId = await window.ethereum.request({ method: "eth_chainId" });
  const BASE_CHAIN_ID_HEX = "0x2135";
  if (chainId !== BASE_CHAIN_ID_HEX) {
    try {
      await window.ethereum.request({ method: "wallet_switchEthereumChain", params: [{ chainId: BASE_CHAIN_ID_HEX }] });
    } catch (err) {
      throw err;
    }
  }
}

async function readDropConfig() {
  try {
    setStatus("Reading publicDrop config...");
    const readProvider = window.ethereum ? new ethers.BrowserProvider(window.ethereum) : new ethers.JsonRpcProvider("https://mainnet.base.org");
    const seadrop = new ethers.Contract(CONFIG.SEADROP_ADDRESS, SEADROP_ABI, readProvider);

    const publicDrop = await seadrop.getPublicDrop(CONFIG.NFT_CONTRACT);
    const mintPriceWei = BigInt(publicDrop[0].toString ? publicDrop[0].toString() : publicDrop[0]);
    const feeBps = Number(publicDrop[4]);
    const restrict = Boolean(publicDrop[5]);

    const mintPriceEth = ethers.formatEther(mintPriceWei);
    priceEl.innerText = mintPriceEth + " ETH";

    let feeRecipient = ethers.ZeroAddress;
    if (!restrict) {
      feeRecipient = ethers.ZeroAddress;
      feeEl.innerText = "ZeroAddress (no restriction)";
      setStatus("Public drop (no fee restriction).");
    } else {
      try {
        setStatus("restrictFeeRecipients=true — trying helpers...");
        let recips = [];
        try { recips = await seadrop.getAllowedFeeRecipients(CONFIG.NFT_CONTRACT); }
        catch(e1){ recips = await seadrop.getFeeRecipients(CONFIG.NFT_CONTRACT); }
        if (recips && recips.length>0){
          feeRecipient = recips[0];
          feeEl.innerText = short(feeRecipient) + " (from helper)";
          setStatus("Using allowed feeRecipient from helper.");
        } else throw new Error("no helper recips");
      } catch(e){
        feeRecipient = CONFIG.FALLBACK_FEE_RECIPIENT;
        feeEl.innerText = short(feeRecipient) + " (fallback)";
        setStatus("Using fallback feeRecipient from multiConfigure.");
      }
    }
    return { mintPriceWei, feeRecipient, feeBps, restrict };
  } catch (err) {
    console.warn("readDropConfig failed:", err);
    const fallbackWei = ethers.parseEther(CONFIG.FALLBACK_PRICE_ETH);
    priceEl.innerText = CONFIG.FALLBACK_PRICE_ETH + " ETH (fallback)";
    feeEl.innerText = short(CONFIG.FALLBACK_FEE_RECIPIENT) + " (fallback)";
    setStatus("Used fallback config due to error.");
    return { mintPriceWei: fallbackWei, feeRecipient: CONFIG.FALLBACK_FEE_RECIPIENT, feeBps:0, restrict:false };
  }
}

connectBtn.onclick = async () => {
  try {
    if(!window.ethereum){ alert("Install MetaMask"); return; }
    await window.ethereum.request({ method: "eth_requestAccounts" });
    await ensureBaseNetwork();
    provider = new ethers.BrowserProvider(window.ethereum);
    signer = await provider.getSigner();
    const addr = await signer.getAddress();
    setStatus("Connected: " + short(addr));
  } catch(err){
    console.error(err);
    setStatus("Connect failed: " + (err?.message||err));
  }
};

refreshBtn.onclick = async () => { await readPriceOnChain(); };

async function readPriceOnChain(){
  const cfg = await readDropConfig();
  return cfg.mintPriceWei;
}

mintBtn.onclick = async () => {
  try {
    if(!window.ethereum){ alert("Install MetaMask"); return; }
    if(!signer){ await connectBtn.onclick(); if(!signer) return; }

    setStatus("Preparing mint — reading on-chain config...");
    const { mintPriceWei, feeRecipient } = await readDropConfig();
    const qty = Math.max(1, Number(qtyEl.value) || 1);
    const total = mintPriceWei * BigInt(qty);

    setStatus("Sending mint tx — total: " + ethers.formatEther(total) + " ETH");

    const seadropWithSigner = new ethers.Contract(CONFIG.SEADROP_ADDRESS, SEADROP_ABI, signer);
    const minterIfNotPayer = ethers.ZeroAddress;

    const tx = await seadropWithSigner.mintPublic(
      CONFIG.NFT_CONTRACT,
      feeRecipient,
      minterIfNotPayer,
      qty,
      { value: total }
    );

    setStatus("Tx sent: " + tx.hash);
    await tx.wait();
    setStatus("Mint confirmed: " + tx.hash);
  } catch(err){
    console.error(err);
    setStatus("Mint failed: " + (err?.message || err));
  }
};

// auto apply defaults on load and read price
applyConfigFromForm();
readPriceOnChain().catch(e=>console.warn(e));

</script>
</body>
</html>
